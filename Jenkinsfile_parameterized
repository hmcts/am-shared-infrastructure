#!groovy
//noinspection GroovyUnusedAssignment
@Library("Infrastructure") _

//noinspection GroovyAssignabilityCheck
properties([
		parameters([
            string(name: 'PRODUCT_NAME', defaultValue: 'am', description: ''),
            choice(name: 'ENVIRONMENT', choices: 'saat\nsprod\sandbox\nspreview', description: 'Environment where code should be build and deployed')
		]),
		[$class: 'BuildDiscarderProperty', strategy: [$class: 'LogRotator', artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '7', numToKeepStr: '30']]
])

echo "Building AM Shared Infrastructure in environment '${params.ENVIRONMENT}'"

slackChannel = '#am-param-builds'

node {
  env.PATH = "$env.PATH:/usr/local/bin"

  stage('Checkout') {
    deleteDir()
    checkout scm
  }

  stage('Create shared infrastructure') {
    sharedInfrastructurePipeline('am', params.ENVIRONMENT, 'sandbox')
  }
}